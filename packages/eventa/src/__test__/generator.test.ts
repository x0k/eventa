import { buildIterator } from '../iterator'

import { buildGenerator } from '../generator'

import schedule from '../data/calculableSchedule.json'

const expected = [ { milliseconds: 1557152400000,
  hour: 17,
  date: 6,
  day: 1,
  dateMilliseconds: 1557090000000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 20,
  hourMilliseconds: 1557151200000,
  call: 6,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лаб.',
  teacher: 'Майнина К.А.',
  room: '504/1' },
{ milliseconds: 1557154800000,
  hour: 18,
  date: 6,
  day: 1,
  dateMilliseconds: 1557090000000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 0,
  hourMilliseconds: 1557154800000,
  call: 6,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лаб.',
  teacher: 'Майнина К.А.',
  room: '504/1' },
{ milliseconds: 1557160800000,
  hour: 19,
  date: 6,
  day: 1,
  dateMilliseconds: 1557090000000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 40,
  hourMilliseconds: 1557158400000,
  call: 7,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лаб.',
  teacher: 'Майнина К.А.',
  room: '504/1' },
{ milliseconds: 1557163200000,
  hour: 20,
  date: 6,
  day: 1,
  dateMilliseconds: 1557090000000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 20,
  hourMilliseconds: 1557162000000,
  call: 7,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лаб.',
  teacher: 'Майнина К.А.',
  room: '504/1' },
{ milliseconds: 1557325200000,
  hour: 17,
  date: 8,
  day: 3,
  dateMilliseconds: 1557262800000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 20,
  hourMilliseconds: 1557324000000,
  call: 6,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лаб.',
  teacher: 'Майнина К.А.',
  room: '504/1' },
{ milliseconds: 1557327600000,
  hour: 18,
  date: 8,
  day: 3,
  dateMilliseconds: 1557262800000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 0,
  hourMilliseconds: 1557327600000,
  call: 6,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лаб.',
  teacher: 'Майнина К.А.',
  room: '504/1' },
{ milliseconds: 1557333600000,
  hour: 19,
  date: 8,
  day: 3,
  dateMilliseconds: 1557262800000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 40,
  hourMilliseconds: 1557331200000,
  call: 7,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лаб.',
  teacher: 'Майнина К.А.',
  room: '504/1' },
{ milliseconds: 1557336000000,
  hour: 20,
  date: 8,
  day: 3,
  dateMilliseconds: 1557262800000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 20,
  hourMilliseconds: 1557334800000,
  call: 7,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лаб.',
  teacher: 'Майнина К.А.',
  room: '504/1' },
{ milliseconds: 1557465600000,
  hour: 8,
  date: 10,
  day: 5,
  dateMilliseconds: 1557435600000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 20,
  hourMilliseconds: 1557464400000,
  call: 1,
  subject: 'Специальная лаборатория дипломного проектирования',
  type: 'пр.',
  teacher: 'Бабенко В.В.',
  room: '516/1' },
{ milliseconds: 1557468000000,
  hour: 9,
  date: 10,
  day: 5,
  dateMilliseconds: 1557435600000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 0,
  hourMilliseconds: 1557468000000,
  call: 1,
  subject: 'Специальная лаборатория дипломного проектирования',
  type: 'пр.',
  teacher: 'Бабенко В.В.',
  room: '516/1' },
{ milliseconds: 1557474000000,
  hour: 10,
  date: 10,
  day: 5,
  dateMilliseconds: 1557435600000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 40,
  hourMilliseconds: 1557471600000,
  call: 2,
  subject: 'Специальная лаборатория дипломного проектирования',
  type: 'пр.',
  teacher: 'Бабенко В.В.',
  room: '516/1' },
{ milliseconds: 1557498000000,
  hour: 17,
  date: 10,
  day: 5,
  dateMilliseconds: 1557435600000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 20,
  hourMilliseconds: 1557496800000,
  call: 6,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лек.',
  teacher: 'Майнина К.А.',
  room: '251/1' },
{ milliseconds: 1557500400000,
  hour: 18,
  date: 10,
  day: 5,
  dateMilliseconds: 1557435600000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 0,
  hourMilliseconds: 1557500400000,
  call: 6,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лек.',
  teacher: 'Майнина К.А.',
  room: '251/1' },
{ milliseconds: 1557506400000,
  hour: 19,
  date: 10,
  day: 5,
  dateMilliseconds: 1557435600000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 40,
  hourMilliseconds: 1557504000000,
  call: 7,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лек.',
  teacher: 'Майнина К.А.',
  room: '251/1' },
{ milliseconds: 1557508800000,
  hour: 20,
  date: 10,
  day: 5,
  dateMilliseconds: 1557435600000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 20,
  hourMilliseconds: 1557507600000,
  call: 7,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лек.',
  teacher: 'Майнина К.А.',
  room: '251/1' },
{ milliseconds: 1557560400000,
  hour: 10,
  date: 11,
  day: 6,
  dateMilliseconds: 1557522000000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 40,
  hourMilliseconds: 1557558000000,
  call: 2,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лек.',
  teacher: 'Майнина К.А.',
  room: '412/1' },
{ milliseconds: 1557584400000,
  hour: 17,
  date: 11,
  day: 6,
  dateMilliseconds: 1557522000000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 20,
  hourMilliseconds: 1557583200000,
  call: 6,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лек.',
  teacher: 'Майнина К.А.',
  room: '412/1' },
{ milliseconds: 1557586800000,
  hour: 18,
  date: 11,
  day: 6,
  dateMilliseconds: 1557522000000,
  month: 4,
  monthMilliseconds: 1556658000000,
  year: 2019,
  minute: 0,
  hourMilliseconds: 1557586800000,
  call: 6,
  subject: 'Программная инженерия и информационный менеджмент',
  type: 'лек.',
  teacher: 'Майнина К.А.',
  room: '412/1' } ]

test('Generate schedule', () => {
  const { period: { start, end }, rules } = schedule
  const iterator = buildIterator(new Date(start), new Date(end), {
    minute: {
      step: 100
    }
  })
  const gen = buildGenerator(rules, iterator)
  const items = [...gen].filter(data => data.subject)
  expect(items).toEqual(expected)
})

test('With selector', () => {
  const { period: { start, end }, rules } = schedule
  const iterator = buildIterator(new Date(start), new Date(end), {
    minute: {
      step: 100
    }
  })
  const gen = buildGenerator(rules, iterator, (data) => data.teacher === 'Бабенко В.В.')
  const items = [...gen].filter(data => data.subject)
  expect(items).toEqual(expected.filter(({ teacher }) => teacher === 'Бабенко В.В.'))
})