import { buildIterator } from '../iterator'

test('Basic iterator', () => {
  const begin = new Date(2001, 0, 1, 1)
  const end = new Date(2001, 0, 3, 13)
  const iterator = buildIterator(begin, end, {
    minute: {
      step: 30,
      expression: [ "$>>", "@get", ["minute"], '@not', [ '@equal', [ 30 ] ] ]
    },
    hour: {
      step: 12
    }
  })
  const items = Array.from(iterator)
  expect(items).toEqual([ { milliseconds: 978300000000,
    hour: 1,
    date: 1,
    day: 1,
    dateMilliseconds: 978296400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 978300000000 },
  { milliseconds: 978343200000,
    hour: 13,
    date: 1,
    day: 1,
    dateMilliseconds: 978296400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 978343200000 },
  { milliseconds: 978386400000,
    hour: 1,
    date: 2,
    day: 2,
    dateMilliseconds: 978382800000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 978386400000 },
  { milliseconds: 978429600000,
    hour: 13,
    date: 2,
    day: 2,
    dateMilliseconds: 978382800000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 978429600000 },
  { milliseconds: 978472800000,
    hour: 1,
    date: 3,
    day: 3,
    dateMilliseconds: 978469200000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 978472800000 },
  { milliseconds: 978516000000,
    hour: 13,
    date: 3,
    day: 3,
    dateMilliseconds: 978469200000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 978516000000 } ])
})

test('Constraints', () => {
  const begin = new Date(2001, 0)
  const end = new Date(2006, 0)
  const iterator = buildIterator(begin, end, {
    minute: {
      step: 30,
    },
    hour: {
      step: 12
    },
    date: {
      step: 15,
    },
    month: {
      step: 6
    },
    year: {
      step: 3
    }
  })
  const items = Array.from(iterator)
  expect(items).toEqual([ { milliseconds: 978296400000,
    hour: 0,
    date: 1,
    day: 1,
    dateMilliseconds: 978296400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 978296400000 },
  { milliseconds: 978298200000,
    hour: 0,
    date: 1,
    day: 1,
    dateMilliseconds: 978296400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 30,
    hourMilliseconds: 978296400000 },
  { milliseconds: 978339600000,
    hour: 12,
    date: 1,
    day: 1,
    dateMilliseconds: 978296400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 978339600000 },
  { milliseconds: 978341400000,
    hour: 12,
    date: 1,
    day: 1,
    dateMilliseconds: 978296400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 30,
    hourMilliseconds: 978339600000 },
  { milliseconds: 979592400000,
    hour: 0,
    date: 16,
    day: 2,
    dateMilliseconds: 979592400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 979592400000 },
  { milliseconds: 979594200000,
    hour: 0,
    date: 16,
    day: 2,
    dateMilliseconds: 979592400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 30,
    hourMilliseconds: 979592400000 },
  { milliseconds: 979635600000,
    hour: 12,
    date: 16,
    day: 2,
    dateMilliseconds: 979592400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 979635600000 },
  { milliseconds: 979637400000,
    hour: 12,
    date: 16,
    day: 2,
    dateMilliseconds: 979592400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 30,
    hourMilliseconds: 979635600000 },
  { milliseconds: 980888400000,
    hour: 0,
    date: 31,
    day: 3,
    dateMilliseconds: 980888400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 980888400000 },
  { milliseconds: 980890200000,
    hour: 0,
    date: 31,
    day: 3,
    dateMilliseconds: 980888400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 30,
    hourMilliseconds: 980888400000 },
  { milliseconds: 980931600000,
    hour: 12,
    date: 31,
    day: 3,
    dateMilliseconds: 980888400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 980931600000 },
  { milliseconds: 980933400000,
    hour: 12,
    date: 31,
    day: 3,
    dateMilliseconds: 980888400000,
    month: 0,
    monthMilliseconds: 978296400000,
    year: 2001,
    minute: 30,
    hourMilliseconds: 980931600000 },
  { milliseconds: 994017600000,
    hour: 0,
    date: 2,
    day: 1,
    dateMilliseconds: 994017600000,
    month: 6,
    monthMilliseconds: 993931200000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 994017600000 },
  { milliseconds: 994019400000,
    hour: 0,
    date: 2,
    day: 1,
    dateMilliseconds: 994017600000,
    month: 6,
    monthMilliseconds: 993931200000,
    year: 2001,
    minute: 30,
    hourMilliseconds: 994017600000 },
  { milliseconds: 994060800000,
    hour: 12,
    date: 2,
    day: 1,
    dateMilliseconds: 994017600000,
    month: 6,
    monthMilliseconds: 993931200000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 994060800000 },
  { milliseconds: 994062600000,
    hour: 12,
    date: 2,
    day: 1,
    dateMilliseconds: 994017600000,
    month: 6,
    monthMilliseconds: 993931200000,
    year: 2001,
    minute: 30,
    hourMilliseconds: 994060800000 },
  { milliseconds: 995313600000,
    hour: 0,
    date: 17,
    day: 2,
    dateMilliseconds: 995313600000,
    month: 6,
    monthMilliseconds: 993931200000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 995313600000 },
  { milliseconds: 995315400000,
    hour: 0,
    date: 17,
    day: 2,
    dateMilliseconds: 995313600000,
    month: 6,
    monthMilliseconds: 993931200000,
    year: 2001,
    minute: 30,
    hourMilliseconds: 995313600000 },
  { milliseconds: 995356800000,
    hour: 12,
    date: 17,
    day: 2,
    dateMilliseconds: 995313600000,
    month: 6,
    monthMilliseconds: 993931200000,
    year: 2001,
    minute: 0,
    hourMilliseconds: 995356800000 },
  { milliseconds: 995358600000,
    hour: 12,
    date: 17,
    day: 2,
    dateMilliseconds: 995313600000,
    month: 6,
    monthMilliseconds: 993931200000,
    year: 2001,
    minute: 30,
    hourMilliseconds: 995356800000 },
  { milliseconds: 1073077200000,
    hour: 0,
    date: 3,
    day: 6,
    dateMilliseconds: 1073077200000,
    month: 0,
    monthMilliseconds: 1072904400000,
    year: 2004,
    minute: 0,
    hourMilliseconds: 1073077200000 },
  { milliseconds: 1073079000000,
    hour: 0,
    date: 3,
    day: 6,
    dateMilliseconds: 1073077200000,
    month: 0,
    monthMilliseconds: 1072904400000,
    year: 2004,
    minute: 30,
    hourMilliseconds: 1073077200000 },
  { milliseconds: 1073120400000,
    hour: 12,
    date: 3,
    day: 6,
    dateMilliseconds: 1073077200000,
    month: 0,
    monthMilliseconds: 1072904400000,
    year: 2004,
    minute: 0,
    hourMilliseconds: 1073120400000 },
  { milliseconds: 1073122200000,
    hour: 12,
    date: 3,
    day: 6,
    dateMilliseconds: 1073077200000,
    month: 0,
    monthMilliseconds: 1072904400000,
    year: 2004,
    minute: 30,
    hourMilliseconds: 1073120400000 },
  { milliseconds: 1074373200000,
    hour: 0,
    date: 18,
    day: 0,
    dateMilliseconds: 1074373200000,
    month: 0,
    monthMilliseconds: 1072904400000,
    year: 2004,
    minute: 0,
    hourMilliseconds: 1074373200000 },
  { milliseconds: 1074375000000,
    hour: 0,
    date: 18,
    day: 0,
    dateMilliseconds: 1074373200000,
    month: 0,
    monthMilliseconds: 1072904400000,
    year: 2004,
    minute: 30,
    hourMilliseconds: 1074373200000 },
  { milliseconds: 1074416400000,
    hour: 12,
    date: 18,
    day: 0,
    dateMilliseconds: 1074373200000,
    month: 0,
    monthMilliseconds: 1072904400000,
    year: 2004,
    minute: 0,
    hourMilliseconds: 1074416400000 },
  { milliseconds: 1074418200000,
    hour: 12,
    date: 18,
    day: 0,
    dateMilliseconds: 1074373200000,
    month: 0,
    monthMilliseconds: 1072904400000,
    year: 2004,
    minute: 30,
    hourMilliseconds: 1074416400000 },
  { milliseconds: 1088884800000,
    hour: 0,
    date: 4,
    day: 0,
    dateMilliseconds: 1088884800000,
    month: 6,
    monthMilliseconds: 1088625600000,
    year: 2004,
    minute: 0,
    hourMilliseconds: 1088884800000 },
  { milliseconds: 1088886600000,
    hour: 0,
    date: 4,
    day: 0,
    dateMilliseconds: 1088884800000,
    month: 6,
    monthMilliseconds: 1088625600000,
    year: 2004,
    minute: 30,
    hourMilliseconds: 1088884800000 },
  { milliseconds: 1088928000000,
    hour: 12,
    date: 4,
    day: 0,
    dateMilliseconds: 1088884800000,
    month: 6,
    monthMilliseconds: 1088625600000,
    year: 2004,
    minute: 0,
    hourMilliseconds: 1088928000000 },
  { milliseconds: 1088929800000,
    hour: 12,
    date: 4,
    day: 0,
    dateMilliseconds: 1088884800000,
    month: 6,
    monthMilliseconds: 1088625600000,
    year: 2004,
    minute: 30,
    hourMilliseconds: 1088928000000 },
  { milliseconds: 1090180800000,
    hour: 0,
    date: 19,
    day: 1,
    dateMilliseconds: 1090180800000,
    month: 6,
    monthMilliseconds: 1088625600000,
    year: 2004,
    minute: 0,
    hourMilliseconds: 1090180800000 },
  { milliseconds: 1090182600000,
    hour: 0,
    date: 19,
    day: 1,
    dateMilliseconds: 1090180800000,
    month: 6,
    monthMilliseconds: 1088625600000,
    year: 2004,
    minute: 30,
    hourMilliseconds: 1090180800000 },
  { milliseconds: 1090224000000,
    hour: 12,
    date: 19,
    day: 1,
    dateMilliseconds: 1090180800000,
    month: 6,
    monthMilliseconds: 1088625600000,
    year: 2004,
    minute: 0,
    hourMilliseconds: 1090224000000 },
  { milliseconds: 1090225800000,
    hour: 12,
    date: 19,
    day: 1,
    dateMilliseconds: 1090180800000,
    month: 6,
    monthMilliseconds: 1088625600000,
    year: 2004,
    minute: 30,
    hourMilliseconds: 1090224000000 } ])
})