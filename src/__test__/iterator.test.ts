import { buildIterator } from '../iterator'

test('Basic iterator', () => {
  const begin = new Date(2001, 0, 1, 1, 0)
  const end = new Date(2001, 0, 3, 3, 11)
  const iterator = buildIterator(begin, end, {
    minute: {
      step: 30,
      expression: [ "$>>", "@get", ["minute"], '@not', [ '@equal', [ 30 ] ] ]
    },
    hour: {
      step: 12
    }
  })
  const items = Array.from(iterator)
  expect(items).toEqual([ { minute: 0,
    hour: 1,
    day: 1,
    date: 1,
    month: 0,
    year: 2001,
    milliseconds: 978296400000 },
  { minute: 0,
    hour: 13,
    day: 1,
    date: 1,
    month: 0,
    year: 2001,
    milliseconds: 978339600000 },
  { minute: 0,
    hour: 1,
    day: 2,
    date: 2,
    month: 0,
    year: 2001,
    milliseconds: 978382800000 },
  { minute: 0,
    hour: 13,
    day: 2,
    date: 2,
    month: 0,
    year: 2001,
    milliseconds: 978426000000 },
  { minute: 0,
    hour: 1,
    day: 3,
    date: 3,
    month: 0,
    year: 2001,
    milliseconds: 978469200000 } ])
})

test('Constraints', () => {
  const begin = new Date(2001, 0)
  const end = new Date(2011, 0)
  const iterator = buildIterator(begin, end, {
    minute: {
      step: 30,
    },
    hour: {
      step: 12
    },
    date: {
      step: 15,
    },
    month: {
      step: 6
    },
    year: {
      step: 3
    }
  })
  const items = Array.from(iterator)
  expect(items).toEqual([ { minute: 0,
    hour: 0,
    day: 1,
    date: 1,
    month: 0,
    year: 2001,
    milliseconds: 978296400000 },
  { minute: 30,
    hour: 0,
    day: 1,
    date: 1,
    month: 0,
    year: 2001,
    milliseconds: 978298200000 },
  { minute: 0,
    hour: 12,
    day: 1,
    date: 1,
    month: 0,
    year: 2001,
    milliseconds: 978339600000 },
  { minute: 30,
    hour: 12,
    day: 1,
    date: 1,
    month: 0,
    year: 2001,
    milliseconds: 978341400000 },
  { minute: 0,
    hour: 0,
    day: 2,
    date: 16,
    month: 0,
    year: 2001,
    milliseconds: 979592400000 },
  { minute: 30,
    hour: 0,
    day: 2,
    date: 16,
    month: 0,
    year: 2001,
    milliseconds: 979594200000 },
  { minute: 0,
    hour: 12,
    day: 2,
    date: 16,
    month: 0,
    year: 2001,
    milliseconds: 979635600000 },
  { minute: 30,
    hour: 12,
    day: 2,
    date: 16,
    month: 0,
    year: 2001,
    milliseconds: 979637400000 },
  { minute: 0,
    hour: 0,
    day: 3,
    date: 31,
    month: 0,
    year: 2001,
    milliseconds: 980888400000 },
  { minute: 30,
    hour: 0,
    day: 3,
    date: 31,
    month: 0,
    year: 2001,
    milliseconds: 980890200000 },
  { minute: 0,
    hour: 12,
    day: 3,
    date: 31,
    month: 0,
    year: 2001,
    milliseconds: 980931600000 },
  { minute: 30,
    hour: 12,
    day: 3,
    date: 31,
    month: 0,
    year: 2001,
    milliseconds: 980933400000 },
  { minute: 0,
    hour: 0,
    day: 0,
    date: 15,
    month: 6,
    year: 2001,
    milliseconds: 993931200000 },
  { minute: 30,
    hour: 0,
    day: 0,
    date: 15,
    month: 6,
    year: 2001,
    milliseconds: 993933000000 },
  { minute: 0,
    hour: 12,
    day: 0,
    date: 15,
    month: 6,
    year: 2001,
    milliseconds: 993974400000 },
  { minute: 30,
    hour: 12,
    day: 0,
    date: 15,
    month: 6,
    year: 2001,
    milliseconds: 993976200000 },
  { minute: 0,
    hour: 0,
    day: 1,
    date: 30,
    month: 6,
    year: 2001,
    milliseconds: 995227200000 },
  { minute: 30,
    hour: 0,
    day: 1,
    date: 30,
    month: 6,
    year: 2001,
    milliseconds: 995229000000 },
  { minute: 0,
    hour: 12,
    day: 1,
    date: 30,
    month: 6,
    year: 2001,
    milliseconds: 995270400000 },
  { minute: 30,
    hour: 12,
    day: 1,
    date: 30,
    month: 6,
    year: 2001,
    milliseconds: 995272200000 },
  { minute: 0,
    hour: 0,
    day: 3,
    date: 14,
    month: 0,
    year: 2004,
    milliseconds: 1072904400000 },
  { minute: 30,
    hour: 0,
    day: 3,
    date: 14,
    month: 0,
    year: 2004,
    milliseconds: 1072906200000 },
  { minute: 0,
    hour: 12,
    day: 3,
    date: 14,
    month: 0,
    year: 2004,
    milliseconds: 1072947600000 },
  { minute: 30,
    hour: 12,
    day: 3,
    date: 14,
    month: 0,
    year: 2004,
    milliseconds: 1072949400000 },
  { minute: 0,
    hour: 0,
    day: 4,
    date: 29,
    month: 0,
    year: 2004,
    milliseconds: 1074200400000 },
  { minute: 30,
    hour: 0,
    day: 4,
    date: 29,
    month: 0,
    year: 2004,
    milliseconds: 1074202200000 },
  { minute: 0,
    hour: 12,
    day: 4,
    date: 29,
    month: 0,
    year: 2004,
    milliseconds: 1074243600000 },
  { minute: 30,
    hour: 12,
    day: 4,
    date: 29,
    month: 0,
    year: 2004,
    milliseconds: 1074245400000 },
  { minute: 0,
    hour: 0,
    day: 2,
    date: 13,
    month: 6,
    year: 2004,
    milliseconds: 1088625600000 },
  { minute: 30,
    hour: 0,
    day: 2,
    date: 13,
    month: 6,
    year: 2004,
    milliseconds: 1088627400000 },
  { minute: 0,
    hour: 12,
    day: 2,
    date: 13,
    month: 6,
    year: 2004,
    milliseconds: 1088668800000 },
  { minute: 30,
    hour: 12,
    day: 2,
    date: 13,
    month: 6,
    year: 2004,
    milliseconds: 1088670600000 },
  { minute: 0,
    hour: 0,
    day: 3,
    date: 28,
    month: 6,
    year: 2004,
    milliseconds: 1089921600000 },
  { minute: 30,
    hour: 0,
    day: 3,
    date: 28,
    month: 6,
    year: 2004,
    milliseconds: 1089923400000 },
  { minute: 0,
    hour: 12,
    day: 3,
    date: 28,
    month: 6,
    year: 2004,
    milliseconds: 1089964800000 },
  { minute: 30,
    hour: 12,
    day: 3,
    date: 28,
    month: 6,
    year: 2004,
    milliseconds: 1089966600000 },
  { minute: 0,
    hour: 0,
    day: 5,
    date: 12,
    month: 0,
    year: 2007,
    milliseconds: 1167598800000 },
  { minute: 30,
    hour: 0,
    day: 5,
    date: 12,
    month: 0,
    year: 2007,
    milliseconds: 1167600600000 },
  { minute: 0,
    hour: 12,
    day: 5,
    date: 12,
    month: 0,
    year: 2007,
    milliseconds: 1167642000000 },
  { minute: 30,
    hour: 12,
    day: 5,
    date: 12,
    month: 0,
    year: 2007,
    milliseconds: 1167643800000 },
  { minute: 0,
    hour: 0,
    day: 6,
    date: 27,
    month: 0,
    year: 2007,
    milliseconds: 1168894800000 },
  { minute: 30,
    hour: 0,
    day: 6,
    date: 27,
    month: 0,
    year: 2007,
    milliseconds: 1168896600000 },
  { minute: 0,
    hour: 12,
    day: 6,
    date: 27,
    month: 0,
    year: 2007,
    milliseconds: 1168938000000 },
  { minute: 30,
    hour: 12,
    day: 6,
    date: 27,
    month: 0,
    year: 2007,
    milliseconds: 1168939800000 },
  { minute: 0,
    hour: 0,
    day: 3,
    date: 11,
    month: 6,
    year: 2007,
    milliseconds: 1183233600000 },
  { minute: 30,
    hour: 0,
    day: 3,
    date: 11,
    month: 6,
    year: 2007,
    milliseconds: 1183235400000 },
  { minute: 0,
    hour: 12,
    day: 3,
    date: 11,
    month: 6,
    year: 2007,
    milliseconds: 1183276800000 },
  { minute: 30,
    hour: 12,
    day: 3,
    date: 11,
    month: 6,
    year: 2007,
    milliseconds: 1183278600000 },
  { minute: 0,
    hour: 0,
    day: 4,
    date: 26,
    month: 6,
    year: 2007,
    milliseconds: 1184529600000 },
  { minute: 30,
    hour: 0,
    day: 4,
    date: 26,
    month: 6,
    year: 2007,
    milliseconds: 1184531400000 },
  { minute: 0,
    hour: 12,
    day: 4,
    date: 26,
    month: 6,
    year: 2007,
    milliseconds: 1184572800000 },
  { minute: 30,
    hour: 12,
    day: 4,
    date: 26,
    month: 6,
    year: 2007,
    milliseconds: 1184574600000 },
  { minute: 0,
    hour: 0,
    day: 0,
    date: 10,
    month: 0,
    year: 2010,
    milliseconds: 1262293200000 },
  { minute: 30,
    hour: 0,
    day: 0,
    date: 10,
    month: 0,
    year: 2010,
    milliseconds: 1262295000000 },
  { minute: 0,
    hour: 12,
    day: 0,
    date: 10,
    month: 0,
    year: 2010,
    milliseconds: 1262336400000 },
  { minute: 30,
    hour: 12,
    day: 0,
    date: 10,
    month: 0,
    year: 2010,
    milliseconds: 1262338200000 },
  { minute: 0,
    hour: 0,
    day: 1,
    date: 25,
    month: 0,
    year: 2010,
    milliseconds: 1263589200000 },
  { minute: 30,
    hour: 0,
    day: 1,
    date: 25,
    month: 0,
    year: 2010,
    milliseconds: 1263591000000 },
  { minute: 0,
    hour: 12,
    day: 1,
    date: 25,
    month: 0,
    year: 2010,
    milliseconds: 1263632400000 },
  { minute: 30,
    hour: 12,
    day: 1,
    date: 25,
    month: 0,
    year: 2010,
    milliseconds: 1263634200000 },
  { minute: 0,
    hour: 0,
    day: 5,
    date: 9,
    month: 6,
    year: 2010,
    milliseconds: 1277928000000 },
  { minute: 30,
    hour: 0,
    day: 5,
    date: 9,
    month: 6,
    year: 2010,
    milliseconds: 1277929800000 },
  { minute: 0,
    hour: 12,
    day: 5,
    date: 9,
    month: 6,
    year: 2010,
    milliseconds: 1277971200000 },
  { minute: 30,
    hour: 12,
    day: 5,
    date: 9,
    month: 6,
    year: 2010,
    milliseconds: 1277973000000 },
  { minute: 0,
    hour: 0,
    day: 6,
    date: 24,
    month: 6,
    year: 2010,
    milliseconds: 1279224000000 },
  { minute: 30,
    hour: 0,
    day: 6,
    date: 24,
    month: 6,
    year: 2010,
    milliseconds: 1279225800000 },
  { minute: 0,
    hour: 12,
    day: 6,
    date: 24,
    month: 6,
    year: 2010,
    milliseconds: 1279267200000 },
  { minute: 30,
    hour: 12,
    day: 6,
    date: 24,
    month: 6,
    year: 2010,
    milliseconds: 1279269000000 } ])
})